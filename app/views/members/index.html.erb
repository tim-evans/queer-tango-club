<% content_for :title, "#{@event.title} | Queer Tango Club" %>
<br>
<div class="grid-frame">
  <section id="schedule">
    <h2><%= link_to(@event.title, event_path(@event)) %> <%= icon("right") %> <% if @event.is_a?(Workshop) %>Sign Ups<% else %>Attendees<% end %></h2>
    <% if @event.is_a?(Workshop) %>
      <nav class="align-right">
        <hr>
        <%= mail_to(nil, subject: @event.title, bcc: @event.members.map(&:formatted_email).join(', ')) do %>
          <%= icon("email-solid") %> Email Members
        <% end %>
        <%= link_to choose_event_path(@event) do %>
          <%= icon("ticket-solid") %> Sign Up
        <% end %>
        <hr class="thick">
      </nav>
    <% end %>
    <% @event.sessions.order(starts_at: :asc).each do |session| %>
      <% if session.ticket_cost %>
        <h4 class="accordion" data-accordion="accordion-<%= session.id %>">
          <%= session.title.html_safe %><%= icon("down") %>
        </h4>
        <hr>
        <div class="members" id="accordion-<%= session.id %>">
          <% if session.attendees.count > 0 %>
            <div class="table">
              <div class="table-header">
                <div class="row">
                  <div class="table-cell attended"></div>
                  <div class="table-cell name">Name</div>
                  <div class="table-cell email">Email</div>
                  <div class="table-cell paid">Paid</div>
                </div>
              </div>
              <div class="table-body block">
                <% session.attendees.order(:created_at).each do |attendee| %>
                  <div class="row">
                    <div class="table-cell attended">
                      <a href="#" tabindex="0" class="toggle-attended" data-id="<%= attendee.id %>" data-attended="<%= attendee.attended? %>">
                        <% if attendee.attended? %>
                          <%= icon('check-solid') %>
                        <% else %>
                          <%= icon('check') %>
                        <% end %>
                      </a>
                    </div>
                    <div class="table-cell name"><%= attendee.name %></div>
                    <div class="table-cell email"><%= attendee.email %></div>
                    <div class="table-cell paid">
                      <% if attendee.payment_method == 'cash' %>
                        Cash
                      <% elsif attendee.payment_method == 'stripe' %>
                        <a href="<%= attendee.payment_url %>">Online</a>
                      <% elsif attendee.payment_method == 'square' %>
                        <a href="<%= attendee.payment_url %>">Card</a>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          <% else %>
            <br>
            <div class="smcp align-center"><%= icon('sad', class: 'empty-state') %></div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </section>
  <br>
  <br>
</div>
